const XCSRFToken=document.querySelector('[name="_csrfToken"]').value,businessid=document.querySelector("#bussines"),client=document.querySelector("#client"),casino=document.querySelector("#casino"),pieza=document.querySelector("#serial"),id_pieza=document.querySelector("#serial_id"),agregar=document.querySelector("#a√±adir"),amount=document.querySelector("#amount"),money_id=document.querySelector("#money_id"),subtotal=document.querySelector("#subtotal"),process=document.querySelector("#process");async function mostraCotizacion(){const e=`http://${window.location.hostname}/alfastreet/quotes/detailsQuote`,t=await fetch(e),a=await t.json();if(a){const e=document.querySelector("#controller");let t,o=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"});for(let e=0;e<a.length;e++)t+="<tr><td>"+(e+1)+"</td><td>"+a[e].serial+"</td><td>"+a[e].name+"</td><td>"+a[e].amount+"</td><td>"+a[e].value+"</td><td>"+a[e].moneyId+'</td><td class="totails">'+o.format(a[e].total)+" </td></tr>";e.innerHTML=t}}async function buscarEmpresa(e){const t=`http://${window.location.hostname}/alfastreet/quotes/search?business_id=${e}`,a=await fetch(t),o=await a.json();let n;if(o){n='<option value=""> --Seleccione una opcion </option>';for(let e=0;e<o.length;e++)n+=`<option value="${o[e].id}">${o[e].name}</option>`;client.innerHTML=n}return n}async function buscarCasino(e){const t=`http://${window.location.hostname}/alfastreet/quotes/getCasino?client_id=${e}`,a=await fetch(t),o=await a.json();if(o){let e='<option value=""> --Seleccione una opcion </option>';for(let t=0;t<o.length;t++)e+=`<option value="${o[t].id}">${o[t].name}</option>`;casino.innerHTML=e}}async function buscarPieza(e){const t=`http://${window.location.hostname}/alfastreet/quotes/getPart?serial_id=${e}`,a=await fetch(t),o=await a.json();if(o)for(let e=0;e<o.length;e++){id_pieza.value=o[e].id;document.querySelector("#name_serial").value=o[e].name,money_id.value=o[e].money_id;const t=document.querySelector("#value_serial");t.value=o[e].value,amount.addEventListener("keyup",e=>{let a=e.target.value;subtotal.value=t.value*a})}}async function agregarPieza(){const e=new FormData;e.append("typeProduct_id",1),e.append("product_id",id_pieza.value),e.append("amount",amount.value),e.append("money_id",money_id.value),e.append("value",subtotal.value);const t=`http://${window.location.hostname}/alfastreet/quotes/addTmpQuote`,a=await fetch(t,{method:"POST",headers:{"X-CSRF-Token":XCSRFToken},body:e});"ok"===await a.json()&&mostraCotizacion()}async function obtenerDatosCliente(){const e=new FormData;e.append("user_id",8),e.append("business_id",businessid.value);const t=`http://${window.location.hostname}/alfastreet/quotes/dataQuote`,a=await fetch(t,{method:"POST",headers:{"X-CSRF-Token":XCSRFToken},body:e});"ok"===await a.json()&&deleteTmp()}async function deleteTmp(){const e=`http://${window.location.hostname}/alfastreet/quotes/deleteTmp`,t=await fetch(e);"delete"===await t.json()&&Swal.fire({icon:"success",title:"Exito!!",text:"Cotizacion Guardada Correctamente",confirmButtonText:"Ok"}).then(e=>{e.isConfirmed&&window.location.replace(`http://${window.location.hostname}/alfastreet/quotes?sort=id&direction=desc`)})}businessid.addEventListener("change",e=>{buscarEmpresa(e.target.value)}),client.addEventListener("change",e=>{buscarCasino(e.target.value)}),pieza.addEventListener("keyup",e=>{buscarPieza(e.target.value)}),agregar.addEventListener("click",e=>{e.preventDefault(),agregarPieza()}),process.addEventListener("click",e=>{e.preventDefault(),obtenerDatosCliente()});