const XCSRFToken=document.querySelector('[name="_csrfToken"]').value,businessid=document.querySelector("#bussines"),client=document.querySelector("#client"),casino=document.querySelector("#casino"),pieza=document.querySelector("#serial"),id_pieza=document.querySelector("#serial_id"),agregar=document.querySelector("#a√±adir"),amount=document.querySelector("#amount"),money_id=document.querySelector("#money_id"),subtotal=document.querySelector("#subtotal"),process=document.querySelector("#process");async function mostraCotizacion(){const e=`${window.location.protocol}//${window.location.hostname}/quotes/detailsQuote`,o=await fetch(e),t=await o.json();if(t){const e=document.querySelector("#controller");let o,n=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"});for(let e=0;e<t.length;e++)o+="<tr><td>"+(e+1)+"</td><td>"+t[e].serial+"</td><td>"+t[e].name+"</td><td>"+t[e].amount+"</td><td>"+t[e].value+"</td><td>"+t[e].moneyId+'</td><td class="totails">'+n.format(t[e].total)+" </td></tr>";e.innerHTML=o}}async function buscarEmpresa(e){const o=`${window.location.protocol}//${window.location.hostname}/quotes/search?business_id=${e}`,t=await fetch(o),n=await t.json();let a;if(n){a='<option value=""> --Seleccione una opcion </option>';for(let e=0;e<n.length;e++)a+=`<option value="${n[e].id}">${n[e].name}</option>`;client.innerHTML=a}return a}async function buscarCasino(e){const o=`${window.location.protocol}//${window.location.hostname}/quotes/getCasino?client_id=${e}`,t=await fetch(o),n=await t.json();if(n){let e='<option value=""> --Seleccione una opcion </option>';for(let o=0;o<n.length;o++)e+=`<option value="${n[o].id}">${n[o].name}</option>`;casino.innerHTML=e}}async function buscarPieza(e){const o=`${window.location.protocol}//${window.location.hostname}/quotes/getPart?serial_id=${e}`,t=await fetch(o),n=await t.json();if(n)for(let e=0;e<n.length;e++){id_pieza.value=n[e].id;document.querySelector("#name_serial").value=n[e].name,money_id.value=n[e].money_id;const o=document.querySelector("#value_serial");o.value=n[e].value,amount.addEventListener("keyup",e=>{let t=e.target.value;subtotal.value=o.value*t})}}async function agregarPieza(){const e=new FormData;e.append("typeProduct_id",1),e.append("product_id",id_pieza.value),e.append("amount",amount.value),e.append("money_id",money_id.value),e.append("value",subtotal.value);const o=`${window.location.protocol}//${window.location.hostname}/quotes/addTmpQuote`,t=await fetch(o,{method:"POST",headers:{"X-CSRF-Token":XCSRFToken},body:e});"ok"===await t.json()&&mostraCotizacion()}async function obtenerDatosCliente(){const e=new FormData;e.append("user_id",8),e.append("business_id",businessid.value);const o=`${window.location.protocol}//${window.location.hostname}/quotes/dataQuote`,t=await fetch(o,{method:"POST",headers:{"X-CSRF-Token":XCSRFToken},body:e});"ok"===await t.json()&&deleteTmp()}async function deleteTmp(){const e=`${window.location.protocol}//${window.location.hostname}/quotes/deleteTmp`,o=await fetch(e);"delete"===await o.json()&&Swal.fire({icon:"success",title:"Exito!!",text:"Cotizacion Guardada Correctamente",confirmButtonText:"Ok"}).then(e=>{e.isConfirmed&&window.location.replace(`${window.location.protocol}//${window.location.hostname}/quotes?sort=id&direction=desc`)})}businessid.addEventListener("change",e=>{buscarEmpresa(e.target.value)}),client.addEventListener("change",e=>{buscarCasino(e.target.value)}),pieza.addEventListener("keyup",e=>{buscarPieza(e.target.value)}),agregar.addEventListener("click",e=>{e.preventDefault(),agregarPieza()}),process.addEventListener("click",e=>{e.preventDefault(),obtenerDatosCliente()});