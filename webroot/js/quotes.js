const businessid=document.querySelector("#bussines"),client=document.querySelector("#client"),casino=document.querySelector("#casino"),pieza=document.querySelector("#serial"),id_pieza=document.querySelector("#serial_id"),agregar=document.querySelector("#anadir"),amount=document.querySelector("#amount"),money_id=document.querySelector("#money_id"),subtotal=document.querySelector("#subtotal"),process=document.querySelector("#process"),userid=document.querySelector("#userid");async function mostraCotizacion(){const e=`${window.location.protocol}//${window.location.hostname}/tmpdetailsquote/detailsQuote`,o=await fetch(e),t=await o.json();if(t){const e=document.querySelector("#controller");let o="",n=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"});for(let e=0;e<t.length;e++)o+="<tr><td>"+(e+1)+"</td><td>"+t[e].Parts.serial+"</td><td>"+t[e].Parts.name+"</td><td>"+t[e].amount+"</td><td>"+t[e].Parts.value+"</td><td>"+t[e].Monies.name+'</td><td class="totails">'+n.format(t[e].value)+" </td>"+`<td><button onclick="borrarTmp(${t[e].id})" class="btn btn-danger"><svg class="nav-icon" width="20" height="20">\n                <use xlink:href="/vendors/@coreui/icons/svg/free.svg#cil-trash"></use>\n            </svg></button></td></tr>`;e.innerHTML=o}}async function borrarTmp(e){const o=`${window.location.protocol}//${window.location.hostname}/tmpdetailsquote/delete/${e}`,t=await fetch(o);"ok"===await t.json()&&mostraCotizacion()}async function buscarEmpresa(e){const o=`${window.location.protocol}//${window.location.hostname}/quotes/search?business_id=${e}`,t=await fetch(o),n=await t.json();let a;if(n){a='<option value=""> --Seleccione una opcion </option>';for(let e=0;e<n.length;e++)a+=`<option value="${n[e].id}">${n[e].name}</option>`;client.innerHTML=a}return a}async function buscarCasino(e){const o=`${window.location.protocol}//${window.location.hostname}/quotes/getCasino?client_id=${e}`,t=await fetch(o),n=await t.json();if(n){let e='<option value=""> --Seleccione una opcion </option>';for(let o=0;o<n.length;o++)e+=`<option value="${n[o].id}">${n[o].name}</option>`;casino.innerHTML=e}}async function buscarPieza(e){const o=`${window.location.protocol}//${window.location.hostname}/quotes/getPart?serial_id=${e}`,t=await fetch(o),n=await t.json();if(n)for(let e=0;e<n.length;e++){id_pieza.value=n[e].id;document.querySelector("#name_serial").value=n[e].name,money_id.value=n[e].money_id;const o=document.querySelector("#value_serial");o.value=n[e].value,amount.addEventListener("keyup",e=>{let t=e.target.value;subtotal.value=o.value*t})}}async function agregarPieza(){const e=new FormData;e.append("typeProduct_id",1),e.append("product_id",id_pieza.value),e.append("amount",amount.value),e.append("money_id",money_id.value),e.append("value",subtotal.value),Swal.fire({title:"Aregando Producto",html:"Por favor espere!",timerProgressBar:!0,didOpen:()=>{Swal.showLoading()},willClose:()=>{clearInterval(void 0)}}).then(e=>{e.dismiss===Swal.DismissReason.timer&&console.log("I was closed by the timer")});try{const o=`${window.location.protocol}//${window.location.hostname}/tmpdetailsquote/add`,t=await fetch(o,{method:"POST",body:e});"ok"===await t.json()&&(Swal.fire({title:"Exito!!",text:"Producto agregado",icon:"success",allowOutsideClick:!1}),mostraCotizacion())}catch(e){console.log(e),Swal.fire({title:"Ups!!",text:"Ocurrio un error.",icon:"error",allowOutsideClick:!0})}}async function obtenerDatosCliente(){const e=new FormData;e.append("user_id",userid.value),e.append("business_id",businessid.value);const o=`${window.location.protocol}//${window.location.hostname}/quotes/dataQuote`,t=await fetch(o,{method:"POST",body:e});"ok"===await t.json()&&deleteTmp()}async function deleteTmp(){const e=`${window.location.protocol}//${window.location.hostname}/quotes/deleteTmp`,o=await fetch(e);await o.json();Swal.fire({title:"Escribe un comentario sobre la cotizaciÃ³n",input:"textarea",inputPlaceholder:"Escribe los comentarios aqui",inputAttributes:{autocapitalize:"off","aria-label":"Type your message here"},showCancelButton:!0,confirmButtonText:"Enviar",showLoaderOnConfirm:!0,preConfirm:e=>fetch(`${window.location.protocol}//${window.location.hostname}/quotes/comments?comment=${e}`).then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).catch(e=>{Swal.showValidationMessage("Pedido Fallido: "+e)}),allowOutsideClick:()=>!Swal.isLoading()}).then(e=>{e.isConfirmed&&Swal.fire({icon:"success",title:"Exito!!",text:"Cotizacion Guardada Correctamente",confirmButtonText:"Ok"}).then(e=>{e.isConfirmed&&window.location.replace(`${window.location.protocol}//${window.location.hostname}/quotes?sort=id&direction=desc`)})})}businessid.addEventListener("change",e=>{buscarEmpresa(e.target.value)}),client.addEventListener("change",e=>{buscarCasino(e.target.value)}),pieza.addEventListener("keyup",e=>{buscarPieza(e.target.value)}),agregar.addEventListener("click",e=>{e.preventDefault(),agregarPieza()}),process.addEventListener("click",e=>{e.preventDefault(),obtenerDatosCliente()});