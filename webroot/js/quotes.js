const businessid=document.querySelector("#bussines"),client=document.querySelector("#client"),casino=document.querySelector("#casino"),pieza=document.querySelector("#serial"),id_pieza=document.querySelector("#serial_id"),agregar=document.querySelector("#anadir"),amount=document.querySelector("#amount"),money_id=document.querySelector("#money_id"),subtotal=document.querySelector("#subtotal"),process=document.querySelector("#process"),userid=document.querySelector("#userid");async function mostraCotizacion(){const e=`${window.location.protocol}//${window.location.hostname}/quotes/detailsQuote`,t=await fetch(e),o=await t.json();if(o){const e=document.querySelector("#controller");let t="",n=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"});for(let e=0;e<o.length;e++)t+="<tr><td>"+(e+1)+"</td><td>"+o[e].serial+"</td><td>"+o[e].name+"</td><td>"+o[e].amount+"</td><td>"+o[e].value+"</td><td>"+o[e].moneyId+'</td><td class="totails">'+n.format(o[e].total)+" </td></tr>";e.innerHTML=t}}async function buscarEmpresa(e){const t=`${window.location.protocol}//${window.location.hostname}/quotes/search?business_id=${e}`,o=await fetch(t),n=await o.json();let a;if(n){a='<option value=""> --Seleccione una opcion </option>';for(let e=0;e<n.length;e++)a+=`<option value="${n[e].id}">${n[e].name}</option>`;client.innerHTML=a}return a}async function buscarCasino(e){const t=`${window.location.protocol}//${window.location.hostname}/quotes/getCasino?client_id=${e}`,o=await fetch(t),n=await o.json();if(n){let e='<option value=""> --Seleccione una opcion </option>';for(let t=0;t<n.length;t++)e+=`<option value="${n[t].id}">${n[t].name}</option>`;casino.innerHTML=e}}async function buscarPieza(e){const t=`${window.location.protocol}//${window.location.hostname}/quotes/getPart?serial_id=${e}`,o=await fetch(t),n=await o.json();if(n)for(let e=0;e<n.length;e++){id_pieza.value=n[e].id;document.querySelector("#name_serial").value=n[e].name,money_id.value=n[e].money_id;const t=document.querySelector("#value_serial");t.value=n[e].value,amount.addEventListener("keyup",e=>{let o=e.target.value;subtotal.value=t.value*o})}}async function agregarPieza(){const e=new FormData;e.append("typeProduct_id",1),e.append("product_id",id_pieza.value),e.append("amount",amount.value),e.append("money_id",money_id.value),e.append("value",subtotal.value);const t=`${window.location.protocol}//${window.location.hostname}/quotes/addTmpQuote`,o=await fetch(t,{method:"POST",body:e});"ok"===await o.json()&&mostraCotizacion()}async function obtenerDatosCliente(){const e=new FormData;e.append("user_id",userid.value),e.append("business_id",businessid.value);const t=`${window.location.protocol}//${window.location.hostname}/quotes/dataQuote`,o=await fetch(t,{method:"POST",body:e});"ok"===await o.json()&&deleteTmp()}async function deleteTmp(){const e=`${window.location.protocol}//${window.location.hostname}/quotes/deleteTmp`,t=await fetch(e);await t.json();Swal.fire({title:"Escribe un comentario sobre la cotizaciÃ³n",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Enviar",showLoaderOnConfirm:!0,preConfirm:e=>fetch(`${window.location.protocol}//${window.location.hostname}/quotes/comments?comment=${e}`).then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).catch(e=>{Swal.showValidationMessage("Pedido Fallido: "+e)}),allowOutsideClick:()=>!Swal.isLoading()}).then(e=>{e.isConfirmed&&Swal.fire({icon:"success",title:"Exito!!",text:"Cotizacion Guardada Correctamente",confirmButtonText:"Ok"}).then(e=>{e.isConfirmed&&window.location.replace(`${window.location.protocol}//${window.location.hostname}/quotes?sort=id&direction=desc`)})})}businessid.addEventListener("change",e=>{buscarEmpresa(e.target.value)}),client.addEventListener("change",e=>{buscarCasino(e.target.value)}),pieza.addEventListener("keyup",e=>{buscarPieza(e.target.value)}),agregar.addEventListener("click",e=>{e.preventDefault(),agregarPieza()}),process.addEventListener("click",e=>{e.preventDefault(),obtenerDatosCliente()});